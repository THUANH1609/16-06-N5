<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="view_van_ban_tree" model="ir.ui.view">
            <field name="name">van_ban.tree</field>
            <field name="model">quan_ly_van_ban</field>
            <field name="arch" type="xml">
                <tree string="Danh sách văn bản" 
                      decoration-info="trang_thai in ['cho_duyet', 'dang_xu_ly']" 
                      decoration-success="trang_thai in ['da_ky', 'hoan_tat']"
                      decoration-muted="trang_thai == 'huy'">
                    <field name="so_hieu"/>
                    <field name="ten_van_ban" string="Trích yếu nội dung"/>
                    <field name="luong_van_ban" string="Loại văn bản" widget="badge" 
                           decoration-info="luong_van_ban == 'den'" 
                           decoration-warning="luong_van_ban == 'di'"
                           decoration-success="luong_van_ban == 'noi_bo'"/>
                    <field name="hinh_thuc_van_ban" string="Thể loại văn bản" widget="badge"/>
                    <field name="ngay_ban_hanh"/>
                    <field name="nhan_vien_id" string="Nhân sự liên quan"/>
                    <field name="trang_thai" widget="badge" 
                           decoration-success="trang_thai in ['da_ky', 'hoan_tat']" 
                           decoration-warning="trang_thai in ['cho_duyet', 'dang_xu_ly']"
                           decoration-info="trang_thai in ['du_thao', 'tiep_nhan']"/>
                </tree>
            </field>
        </record>

        <record id="view_van_ban_kanban" model="ir.ui.view">
            <field name="name">van_ban.kanban</field>
            <field name="model">quan_ly_van_ban</field>
            <field name="arch" type="xml">
                <kanban default_group_by="trang_thai" class="o_kanban_mobile">
                    <field name="ten_van_ban"/>
                    <field name="so_hieu"/>
                    <field name="trang_thai"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_global_click">
                                <div class="oe_kanban_details">
                                    <strong class="o_kanban_record_title">
                                        <field name="ten_van_ban"/>
                                    </strong>
                                    <div class="o_kanban_record_subtitle">
                                        <field name="so_hieu"/>
                                    </div>
                                    <div class="o_kanban_record_bottom">
                                        <div class="oe_kanban_bottom_left">
                                            <field name="trang_thai" widget="label_selection" options="{'classes': {'du_thao': 'default', 'hoan_tat': 'success', 'huy': 'danger'}}"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="view_van_ban_form" model="ir.ui.view">
            <field name="name">van_ban.form</field>
            <field name="model">quan_ly_van_ban</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button name="action_confirm" string="Trình duyệt" type="object" class="oe_highlight" 
                                attrs="{'invisible': ['|', ('trang_thai', '!=', 'du_thao'), ('luong_van_ban', '=', 'den')]}"/>
                        
                        <button name="action_done" string="Ký/Ban hành" type="object" class="oe_highlight" 
                                attrs="{'invisible': ['|', ('trang_thai', '!=', 'cho_duyet'), ('luong_van_ban', '=', 'den')]}"/>
                        
                        <button name="action_xu_ly" string="Bắt đầu xử lý" type="object" class="oe_highlight" 
                                attrs="{'invisible': ['|', ('trang_thai', 'not in', ['tiep_nhan', 'du_thao']), ('luong_van_ban', '=', 'di')]}"/>
                        
                        <button name="action_hoan_tat" string="Hoàn tất xử lý" type="object" class="oe_highlight" 
                                attrs="{'invisible': ['|', ('trang_thai', '!=', 'dang_xu_ly'), ('luong_van_ban', '=', 'di')]}"/>
                        
                        <button name="action_cancel" string="Hủy bỏ" type="object" 
                                attrs="{'invisible': [('trang_thai', 'in', ['da_ky', 'hoan_tat', 'huy'])]}"/>
                        
                        <field name="trang_thai" widget="statusbar" statusbar_visible="du_thao,cho_duyet,da_ky,tiep_nhan,dang_xu_ly,hoan_tat" clickable="0"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1><field name="so_hieu"/></h1>
                            <label for="ten_van_ban" class="oe_edit_only" string="Trích yếu nội dung"/>
                            <h2><field name="ten_van_ban" placeholder="Ví dụ: Nội dung văn bản..." attrs="{'readonly': [('trang_thai', 'in', ['da_ky', 'hoan_tat'])]}"/></h2>
                        </div>

                        <group>
                            <group string="Thông tin nghiệp vụ &amp; Đối tượng">
                                <field name="luong_van_ban" string="Loại văn bản" readonly="1" force_save="1"/>
                                <field name="hinh_thuc_van_ban" string="Thể loại" attrs="{'readonly': [('trang_thai', '=', 'hoan_tat')]}"/>
                                <field name="nhan_vien_id" 
                                       string="Người tiếp nhận" 
                                       options="{'no_create': True}" 
                                       attrs="{'readonly': [('trang_thai', '=', 'hoan_tat')]}"/>
                                <field name="khach_hang_id" 
                                       string="Cơ quan gửi/Đối tác" 
                                       options="{'no_create': True}" 
                                       attrs="{
                                           'invisible': [('luong_van_ban', '=', 'noi_bo')], 
                                           'required': [('luong_van_ban', '!=', 'noi_bo')],
                                           'readonly': [('trang_thai', '=', 'hoan_tat')]
                                       }"/>
                            </group>
                        
                            <group string="Tệp tin &amp; Thời gian">
                                <field name="file_van_ban" filename="file_name" attrs="{'readonly': [('trang_thai', '=', 'hoan_tat')]}"/>
                                <field name="file_name" invisible="1"/>
                                <field name="ngay_ban_hanh" string="Ngày ban hành" attrs="{'readonly': [('trang_thai', '=', 'hoan_tat')]}"/>
                                <field name="ngay_hieu_luc" attrs="{'readonly': [('trang_thai', '=', 'hoan_tat')]}"/>
                            </group>
                        </group>
                        <!-- <group>
                            <group string="Phân loại nghiệp vụ">
                                <field name="luong_van_ban" string="Luồng văn bản" attrs="{'readonly': [('trang_thai', 'not in', ['du_thao', 'tiep_nhan'])]}"/>
                                <field name="hinh_thuc_van_ban" string="Thể loại" attrs="{'readonly': [('trang_thai', 'in', ['da_ky', 'hoan_tat'])]}"/>
                            </group>
                            <group string="Đối tượng liên quan">
                                <field name="nhan_vien_id" options="{'no_create': True}" attrs="{'readonly': [('trang_thai', 'in', ['da_ky', 'hoan_tat'])]}"/>
                                <field name="khach_hang_id" string="Cơ quan gửi/Đối tác" options="{'no_create': True}" 
                                       attrs="{'invisible': [('luong_van_ban', '=', 'noi_bo')], 'required': [('luong_van_ban', '!=', 'noi_bo')], 'readonly': [('trang_thai', 'in', ['da_ky', 'hoan_tat'])]}"/>
                            </group>
                        </group>
                        <group>
                            <group string="Tệp tin đính kèm">
                                <field name="file_van_ban" filename="file_name" attrs="{'readonly': [('trang_thai', 'in', ['da_ky', 'hoan_tat'])]}"/>
                                <field name="file_name" invisible="1"/>
                            </group>
                            <group string="Thời gian">
                                <field name="ngay_ban_hanh" attrs="{'readonly': [('trang_thai', 'in', ['da_ky', 'hoan_tat'])]}"/>
                                <field name="ngay_hieu_luc" attrs="{'readonly': [('trang_thai', 'in', ['da_ky', 'hoan_tat'])]}"/>
                            </group>
                        </group> -->
                        <notebook>
                            <page string="Nội dung chi tiết">
                                <field name="ghi_chu" widget="html" class="oe_edit_only"/>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="view_van_ban_search" model="ir.ui.view">
            <field name="name">quan_ly_van_ban.search</field>
            <field name="model">quan_ly_van_ban</field>
            <field name="arch" type="xml">
                <search>
                    <field name="ten_van_ban" string="Nội dung/Số hiệu" filter_domain="['|', ('ten_van_ban', 'ilike', self), ('so_hieu', 'ilike', self)]"/>
                    <field name="nhan_vien_id"/>
                    <field name="khach_hang_id"/>
                    <group expand="0" string="Gom nhóm theo">
                        <filter string="Loại văn bản" name="group_luong" context="{'group_by': 'luong_van_ban'}"/>
                        <filter string="Trạng thái" name="group_status" context="{'group_by': 'trang_thai'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="action_quan_ly_van_ban" model="ir.actions.act_window">
            <field name="name">Hệ thống Văn bản</field>
            <field name="res_model">quan_ly_van_ban</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="search_view_id" ref="view_van_ban_search"/>
        </record>
    </data>
</odoo>
<!-- <?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="view_van_ban_tree" model="ir.ui.view">
            <field name="name">van_ban.tree</field>
            <field name="model">quan_ly_van_ban</field>
            <field name="arch" type="xml">
                <tree string="Danh sách văn bản" 
                      decoration-info="trang_thai in ['cho_duyet', 'dang_xu_ly']" 
                      decoration-success="trang_thai in ['da_ky', 'hoan_tat']"
                      decoration-muted="trang_thai == 'huy'">
                    <field name="so_hieu"/>
                    <field name="ten_van_ban" string="Trích yếu nội dung"/>
                    <field name="luong_van_ban" string="Loại văn bản" widget="badge" 
                           decoration-info="luong_van_ban == 'den'" 
                           decoration-warning="luong_van_ban == 'di'"
                           decoration-success="luong_van_ban == 'noi_bo'"/>
                    <field name="hinh_thuc_van_ban" string="Thể loại văn bản" widget="badge"/>
                    <field name="ngay_ban_hanh"/>
                    <field name="nhan_vien_id" string="Nhân sự liên quan"/>
                    <field name="trang_thai" widget="badge" 
                           decoration-success="trang_thai in ['da_ky', 'hoan_tat']" 
                           decoration-warning="trang_thai in ['cho_duyet', 'dang_xu_ly']"
                           decoration-info="trang_thai in ['du_thao', 'tie_nhan']"/>
                </tree>
            </field>
        </record>

        <record id="view_van_ban_kanban" model="ir.ui.view">
            <field name="name">van_ban.kanban</field>
            <field name="model">quan_ly_van_ban</field>
            <field name="arch" type="xml">
                <kanban default_group_by="trang_thai" class="o_kanban_mobile">
                    <field name="ten_van_ban"/>
                    <field name="so_hieu"/>
                    <field name="trang_thai"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_global_click">
                                <div class="oe_kanban_details">
                                    <strong class="o_kanban_record_title">
                                        <field name="ten_van_ban"/>
                                    </strong>
                                    <div class="o_kanban_record_subtitle">
                                        <field name="so_hieu"/>
                                    </div>
                                    <div class="o_kanban_record_bottom">
                                        <div class="oe_kanban_bottom_left">
                                            <field name="trang_thai" widget="label_selection" options="{'classes': {'du_thao': 'default', 'hoan_tat': 'success', 'huy': 'danger'}}"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="view_van_ban_form" model="ir.ui.view">
            <field name="name">van_ban.form</field>
            <field name="model">quan_ly_van_ban</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button name="action_confirm" string="Trình duyệt" type="object" class="oe_highlight" attrs="{'invisible': ['|', ('trang_thai', '!=', 'du_thao'), ('luong_van_ban', '!=', 'di')]}"/>
                        <button name="action_done" string="Ký/Ban hành" type="object" class="oe_highlight" attrs="{'invisible': ['|', ('trang_thai', '!=', 'cho_duyet'), ('luong_van_ban', '!=', 'di')]}"/>
                        <button name="action_xu_ly" string="Bắt đầu xử lý" type="object" class="oe_highlight" attrs="{'invisible': ['|', ('trang_thai', '!=', 'tiep_nhan'), ('luong_van_ban', '!=', 'den')]}"/>
                        <button name="action_hoan_tat" string="Hoàn tất xử lý" type="object" class="oe_highlight" attrs="{'invisible': ['|', ('trang_thai', '!=', 'dang_xu_ly'), ('luong_van_ban', '!=', 'den')]}"/>
                        <button name="action_cancel" string="Hủy bỏ" type="object" attrs="{'invisible': [('trang_thai', 'in', ['da_ky', 'hoan_tat', 'huy'])]}"/>
                        <field name="trang_thai" widget="statusbar" statusbar_visible="du_thao,cho_duyet,da_ky,tiep_nhan,dang_xu_ly,hoan_tat" clickable="1"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1><field name="so_hieu"/></h1>
                            <label for="ten_van_ban" class="oe_edit_only" string="Trích yếu nội dung"/>
                            <h2><field name="ten_van_ban" placeholder="Ví dụ: Quyết định bổ nhiệm nhân sự..." attrs="{'readonly': [('trang_thai', 'in', ['da_ky', 'hoan_tat'])]}"/></h2>
                        </div>
                        <group>
                            <group string="Phân loại nghiệp vụ">
                                <field name="luong_van_ban" string="Luồng văn bản" attrs="{'readonly': [('trang_thai', 'not in', ['du_thao', 'tiep_nhan'])]}"/>
                                <field name="hinh_thuc_van_ban" string="Thể loại" attrs="{'readonly': [('trang_thai', 'in', ['da_ky', 'hoan_tat'])]}"/>
                            </group>
                            <group string="Đối tượng liên quan">
                                <field name="nhan_vien_id" options="{'no_create': True}" attrs="{'readonly': [('trang_thai', 'in', ['da_ky', 'hoan_tat'])]}"/>
                                <field name="khach_hang_id" string="Cơ quan gửi/Đối tác" options="{'no_create': True}" attrs="{'invisible': [('luong_van_ban', '=', 'noi_bo')], 'required': [('luong_van_ban', '!=', 'noi_bo')], 'readonly': [('trang_thai', 'in', ['da_ky', 'hoan_tat'])]}"/>
                            </group>
                        </group>
                        <group>
                            <group string="Tệp tin đính kèm">
                                <field name="file_van_ban" filename="file_name" attrs="{'readonly': [('trang_thai', 'in', ['da_ky', 'hoan_tat'])]}"/>
                                <field name="file_name" invisible="1"/>
                            </group>
                            <group string="Thời gian">
                                <field name="ngay_ban_hanh" attrs="{'readonly': [('trang_thai', 'in', ['da_ky', 'hoan_tat'])]}"/>
                                <field name="ngay_hieu_luc" attrs="{'readonly': [('trang_thai', 'in', ['da_ky', 'hoan_tat'])]}"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Nội dung chi tiết văn bản">
                                <field name="ghi_chu" widget="html" options="{'style-inline': true, 'wysiwyg_only': true, 'wrapper': true}" class="oe_edit_only"/>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="view_van_ban_search" model="ir.ui.view">
            <field name="name">quan_ly_van_ban.search</field>
            <field name="model">quan_ly_van_ban</field>
            <field name="arch" type="xml">
                <search>
                    <field name="ten_van_ban" string="Nội dung/Số hiệu" filter_domain="['|', ('ten_van_ban', 'ilike', self), ('so_hieu', 'ilike', self)]"/>
                    <field name="nhan_vien_id"/>
                    <field name="khach_hang_id"/>
                    <group expand="0" string="Gom nhóm theo">
                        <filter string="Loại văn bản" name="group_luong" context="{'group_by': 'luong_van_ban'}"/>
                        <filter string="Trạng thái" name="group_status" context="{'group_by': 'trang_thai'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="action_quan_ly_van_ban" model="ir.actions.act_window">
            <field name="name">Hệ thống Văn bản</field>
            <field name="res_model">quan_ly_van_ban</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="search_view_id" ref="view_van_ban_search"/>
        </record>
    </data>
</odoo>
 -->
